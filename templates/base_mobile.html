{% load static %}
<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Rotexia Mobile</title>
    <meta name="theme-color" content="#0d6efd">
    <link rel="manifest" href="{% url 'pwa_manifest' %}">
    <link rel="icon" href="{% static 'pwa/icon.svg' %}">
    <link rel="apple-touch-icon" href="{% static 'pwa/icon.svg' %}">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{% static 'css/mobile-app.css' %}?v=2025-12-27-1">
    <link href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-material-ui/material-ui.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<style>
    /* Uyarı pencerelerinin fontunu sisteme uyduralım */
    .swal2-popup {
        font-family: 'Inter', sans-serif !important;
        border-radius: 20px !important;
    }
</style>

</head>

<body>

    <div id="offline-alert" style="display:none; background:#dc3545; color:white; text-align:center; padding:5px; font-size:12px; position:fixed; top:0; width:100%; z-index:99999;">
        <i class="fas fa-wifi-slash"></i> İnternet Bağlantısı Yok - Çevrimdışı Mod (Veriler Cihazda Tutuluyor)
    </div>

    <div id="online-alert" style="display:none; background:#198754; color:white; text-align:center; padding:5px; font-size:12px; position:fixed; top:0; width:100%; z-index:99999;">
        <i class="fas fa-wifi"></i> Bağlantı Geri Geldi - Senkronize Ediliyor...
    </div>

    <div class="mobile-header">
        <button class="btn-menu" type="button" data-bs-toggle="offcanvas" data-bs-target="#sideMenu">
            <i class="fas fa-bars"></i> </button>
        <div class="header-title">Rotexia</div>
        <div style="width: 24px;"></div> </div>

    <div class="offcanvas offcanvas-start" tabindex="-1" id="sideMenu">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title fw-bold text-white">Menüler</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas"></button>
        </div>
        <div class="offcanvas-body p-0">
            <div class="p-3 text-center border-bottom border-secondary">
                <h6 class="m-0 text-white">{{ user.first_name }} {{ user.last_name }}</h6>
                <small class="text-muted">{{ user.username }}</small>
            </div>
            
            <div class="mt-2">
                <a href="{% url 'mobile_home' %}" class="mobile-nav-link active">
                    <i class="fas fa-home"></i> Anasayfa
                </a>
                <a href="#" class="mobile-nav-link">
                    <i class="fas fa-calendar-check"></i> Ziyaretler
                </a>
                <a href="#" class="mobile-nav-link">
                    <i class="fas fa-store"></i> Müşteriler
                </a>
                <a href="#" class="mobile-nav-link">
                    <i class="fas fa-clipboard-list"></i> Formlar
                </a>
                <a href="#" class="mobile-nav-link">
                    <i class="fas fa-folder-open"></i> İçerikler
                </a>
                <a href="#" class="mobile-nav-link">
                    <i class="fas fa-chart-pie"></i> Raporlar
                </a>
                
                <hr class="border-secondary mx-3">
                
                <a href="{% url 'mobile_profile' %}" class="mobile-nav-link">
                    <i class="fas fa-cog"></i> Ayarlar
                </a>
                
                <form action="{% url 'logout' %}" method="post" class="d-grid px-3 mt-4">
                    {% csrf_token %}
                    <button class="btn btn-danger"><i class="fas fa-sign-out-alt me-2"></i> Çıkış Yap</button>
                </form>
            </div>
        </div>
    </div>

    {% block content %}{% endblock %}

    <div class="bottom-nav">
        <a href="{% url 'mobile_home' %}" class="b-nav-item active">
            <i class="fas fa-home"></i>
            <span>Anasayfa</span>
        </a>
        <a href="#" class="b-nav-item">
            <i class="fas fa-map-marker-alt"></i>
            <span>Harita</span>
        </a>
        <a href="{% url 'mobile_profile' %}" class="b-nav-item">
            <i class="fas fa-user"></i>
            <span>Profil</span>
        </a>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // PWA service worker kaydı (Chrome "Ana ekrana ekle" için gerekli)
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
            navigator.serviceWorker.register('{% url "pwa_sw" %}', { scope: '/app/' })
                .catch(() => { /* sessiz */ });
        });
    }

    // İnternet Durumunu Dinle
    window.addEventListener('offline', function(e) {
        document.getElementById('offline-alert').style.display = 'block';
        document.getElementById('online-alert').style.display = 'none';
        // Buraya "Kaydet butonu davranışını değiştir" kodu gelecek
    });

    window.addEventListener('online', function(e) {
        document.getElementById('offline-alert').style.display = 'none';
        document.getElementById('online-alert').style.display = 'block';
        
        // 3 saniye sonra yeşil uyarıyı gizle
        setTimeout(function(){
            document.getElementById('online-alert').style.display = 'none';
        }, 3000);
    });

</script>

</body>
</html>